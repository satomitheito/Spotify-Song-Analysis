<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>report – DSAN-5000: Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/gu-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../report/report.html" aria-current="page"> 
<span class="menu-text">Report</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-details" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technical details</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technical-details">    
        <li>
    <a class="dropdown-item" href="../technical-details/data-collection/main.html">
 <span class="dropdown-text">Data-collection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/data-cleaning/main.html">
 <span class="dropdown-text">Data-cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/eda/main.html">
 <span class="dropdown-text">Exploratory Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/unsupervised-learning/main.html">
 <span class="dropdown-text">Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/supervised-learning/main.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/progress-log.html">
 <span class="dropdown-text">Progress Log</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../technical-details/llm-usage-log.html">
 <span class="dropdown-text">LLM usage Log</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#decoding-song-success---final-report" id="toc-decoding-song-success---final-report" class="nav-link active" data-scroll-target="#decoding-song-success---final-report">Decoding Song Success - Final Report</a>
  <ul class="collapse">
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#key-insights-and-visualizations" id="toc-key-insights-and-visualizations" class="nav-link" data-scroll-target="#key-insights-and-visualizations">Key Insights and Visualizations</a></li>
  <li><a href="#business-implications" id="toc-business-implications" class="nav-link" data-scroll-target="#business-implications">Business Implications</a></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="decoding-song-success---final-report" class="level1">
<h1>Decoding Song Success - Final Report</h1>
<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p>This report, Decoding Song Success, uses a wide range of data visualization and machine learning tools to study the factors that make the hit songs hits. Successful songs were measured by their rank on the Rolling Stone Top 100 songs. By integrating natural language processing (NLP), sentiment anlaysis, and machine learning models, we explored the relationship between lyrical, musical, and artist-specific characteristics of the top songs in the country to identify the key drivers of song success.</p>
<p>Some of the key findings outlined in this report can be found below: 1. Artist popularity plays an important role in song success, with highly popular artists being more likely to have a song at the top of the charts. 2. Emotionally extreme sentiments are strongly correlated with popularity, while neutral sentiments cause songs to not perform as well. 3. Genre features are key drivers in clustering songs, with methods like hierarchical clustering revealing strong patterns within genres. 4. External factors such as social media popularity and marketing likely have an impact on top-ranked songs, which don’t form distinct clusters based on the features studied in this report alone.</p>
<p>These findings have important implications for the music industry, from songwriting strategies to playlist curation and personalized song recommendations.</p>
</section>
<section id="objective" class="level2">
<h2 class="anchored" data-anchor-id="objective">Objective</h2>
<p>This project aims to identify the key factors that contribute to a song’s popularity. We focused on how sentiment, genre, and artist popularity influence success. By analyzing a dataset of Rolling Stone’s top 100 songs, we were able to uncover patterns and relationships that can provide rising artists, music producers, and music platforms with strategies and a deeper understanding of what makes a hit song.</p>
</section>
<section id="key-insights-and-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="key-insights-and-visualizations">Key Insights and Visualizations</h2>
<section id="artist-popularity" class="level4">
<h4 class="anchored" data-anchor-id="artist-popularity">Artist Popularity</h4>
<p>A positive linear relationship was found between artist popularity and song popularity on Spotify. This means that more popular artists are more likely to have highly popular songs. This suggests that newer or lesser-known artists may face challenges breaking into the top ranks unless they have strong support from existing fanbases.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/song_artist.png" class="img-fluid figure-img"></p>
<figcaption>Scatterplot showing the correlation between artist popularity and song popularity</figcaption>
</figure>
</div>
</section>
<section id="sentiment-analysis-reveals-listener-preferences" class="level4">
<h4 class="anchored" data-anchor-id="sentiment-analysis-reveals-listener-preferences">Sentiment Analysis Reveals Listener Preferences</h4>
<p>Songs with negative sentiment tend to perform better in terms of popularity. Explicit content also doesn’t appear to affect popularity significantly. This may be a result of factors like radio stations and public locations not being able to play explicit music. These findings go against the assumption that positive songs perform better, indicating that listeners preference are much more nuanced.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/sentiment_importance.png" class="img-fluid figure-img"></p>
<figcaption>Bar chart showing the feature importances of the different sentimentality scores in a random forest regressor</figcaption>
</figure>
</div>
</section>
<section id="song-duration-and-sentiment-are-interralted" class="level4">
<h4 class="anchored" data-anchor-id="song-duration-and-sentiment-are-interralted">Song Duration and Sentiment are Interralted</h4>
<p>Longer songs tend to be more negative, and shorter songs tend to have more positive sentiment. This pattern can inform music producers and artists about the emotional impact of a song length. Producers may want to take this into consideration when creating songs that they hope to have certain impacts on listeners.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/sent_length.png" class="img-fluid figure-img"></p>
<figcaption>Scatterplot showing the correlation between negative sentiment and song length</figcaption>
</figure>
</div>
</section>
<section id="genre-is-a-strong-influence-on-clustering" class="level4">
<h4 class="anchored" data-anchor-id="genre-is-a-strong-influence-on-clustering">Genre is a Strong Influence on Clustering</h4>
<p>Genre playes a significant role in clustering, with songs from the same genre sharing measurable similarities in features such as duration, sentiment, and word count. However, top 10 songs were distributed across multiple clusters, suggesting that success isn’t only dependent on the genre of the song or other features in this dataset. The importance of this lies in the success of certain songs in specific genres. Since all of this data comes from the Rolling Stone’s Top 100 Songs, it is informative that the songs clustered so nicely into their genres. This shows that there is a formula for success in a given genre. Outliers in the genre clusters were not very common amongst the top 100 songs, so adhering to the rules setup by these genre groupings seems to be a key to success.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/genre_clusters.png" class="img-fluid figure-img"></p>
<figcaption>Scatterplot showing the clusters created by a hierarchical clustering algorithm, visualized on features transformed using t-sne dimensionality reduction</figcaption>
</figure>
</div>
</section>
<section id="playlist-curation-from-clusters" class="level4">
<h4 class="anchored" data-anchor-id="playlist-curation-from-clusters">Playlist Curation from Clusters</h4>
<p>Hierarchical clustering performed the best in grouping songs into 9 clusters, with clear separations between groups. See the above graph for these clusters as visualized on T-SNE. The existence of these clear groupings could be used for a strong song recommendation system based on their preferences.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/dendogram.png" class="img-fluid figure-img"></p>
<figcaption>Dendogram showing how different songs were grouped together in a hierarchical model.</figcaption>
</figure>
</div>
</section>
<section id="supervised-learning-models-gradient-boosting-and-random-forest" class="level4">
<h4 class="anchored" data-anchor-id="supervised-learning-models-gradient-boosting-and-random-forest">Supervised Learning Models: Gradient Boosting and Random Forest</h4>
<p>The Random Forest Regressor was able to use the supplied features to predict the popularity of moderately successful songs with higher accuracy. Gradient Boosting was able to predict Song Rank with extremely high accuracy. Highly important features included sentiment columns, the word counts of the lyrics, and the followers of the artist (as explained above). This emphasizes the role of emotional tone in song success which could inform marketing strategies and playlist creation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/feat_imp.png" class="img-fluid figure-img"></p>
<figcaption>Bar chart showing feature importances in random forest model.</figcaption>
</figure>
</div>
</section>
<section id="general-observations" class="level4">
<h4 class="anchored" data-anchor-id="general-observations">General observations</h4>
<section id="genre-distribution" class="level5">
<h5 class="anchored" data-anchor-id="genre-distribution">Genre Distribution</h5>
<p>Pop dominates the top songs. However, there is a good mix of other genres across all of the top rankings.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/genre_dist.png" class="img-fluid figure-img"></p>
<figcaption>Bar chart showing distribution of genres across top ranked songs.</figcaption>
</figure>
</div>
</section>
<section id="emotional-scores" class="level5">
<h5 class="anchored" data-anchor-id="emotional-scores">Emotional Scores</h5>
<p>There are peaks in compound emotional score at the most extreme sides of the axis, meaning that the most popular songs are very skewed towards one extreme sentiment or the other.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/compound_score.png" class="img-fluid figure-img"></p>
<figcaption>Histogram showing the distribution of compound scores.</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="business-implications" class="level2">
<h2 class="anchored" data-anchor-id="business-implications">Business Implications</h2>
<p>These findings can be useful to a wide range of people who are heavily involved in the music industry. The goals of improving song performance, curating a personalized experiences for listeners, and uplifting emerging artists could be suppoprted by our outcomes.</p>
<section id="artists-and-producers" class="level4">
<h4 class="anchored" data-anchor-id="artists-and-producers">Artists and Producers:</h4>
<p>Popular artists have a clear advantage in their songs achieving success on the charts, as demonstrated by the highly positive correlation between artist popularity and song popularity. This might make it much harder for emerging artists to find their songs higher up in rankings.</p>
<p>In terms of actually producing music, the perceived lyrical sentiment has a big impact on the success of the song. Sentiment analysis has shown that songs with lyrics that convey an extreme emotion (both positive and negative) resonate more with listeners than neutral songs.</p>
<p>Songs that follow the conventions of genres are much more likely to succeed. Artists with songs that are considered “outliers” were not very common in the top 100 chart.</p>
</section>
<section id="streaming-platforms" class="level4">
<h4 class="anchored" data-anchor-id="streaming-platforms">Streaming Platforms:</h4>
<p>Clustering results and genre-based grouping seem to be really important when it comes to finding similar songs for something like a recommendation system. Playlists with priorities on genre features and extreme emotional sentiment end up being the most influential on consumer preferences. Finding similar songs by genre (and using a very accurate system to identify and label these genres) is very important.</p>
</section>
</section>
<section id="recommendations" class="level2">
<h2 class="anchored" data-anchor-id="recommendations">Recommendations</h2>
<p>Based on the insights and business implications, here are some steps for various players in the music industry might take to maximize the potential for their songs to achieve success and to increase listener engagement.</p>
<section id="for-artists-and-producers" class="level4">
<h4 class="anchored" data-anchor-id="for-artists-and-producers">For Artists and Producers</h4>
<ol type="1">
<li><p>Emotional Lyrics and Extreme Sentiments: Focus on writing and producing songs that are clear in their emotional tones (whether it is positive or negative) to connect better with listeners. Avoid neutral or balanced sentiment. Adopting this could lead to a song that charts higher because it aligns better with consumer preferences.</p></li>
<li><p>Collaborate with Popular Artists: Since it is so difficult for less popular artists to breakthrough, emerging artists should collaborate with artists with an established fanbase. This might increase visibility and the credibility of the new artist, leading to an increase in streams and audience reach. This will also help increase the new artist’s popularity, ultimately giving them the opportunity to achieve success on their own.</p></li>
<li><p>Adhere to Genre Norms: Stick to established patterns within a genre to improve a song’s chance of success. Creativity is extremely important in this field but staying aligned with the conventions when it comes to features like song duration, lyric word length, and sentiment might increase listener acceptance and chart performance.</p></li>
</ol>
</section>
<section id="for-streaming-platforms" class="level4">
<h4 class="anchored" data-anchor-id="for-streaming-platforms">For Streaming Platforms</h4>
<ol type="1">
<li><p>Better Recommendation Algorithms: Incorporate hierarchical clustering and T-SNE results to imporve song reecommendation systems. By suggesting songs from the same cluster, the user will be exposed to songs that they will more than likely enjoy and increase user engagement.</p></li>
<li><p>Promote Non-Top 10 Songs Within Clusters: Since top-10 songs are spread throughout the clusters, streaming platforms might be able to create themed playlists that showcase lesser-known songs that the user will probably like to listen to if they liked the top-10 song. This could increase streams for top-10 songs and broaden user’s artist exposure, ultimately giving them more to listen to and increasing engagement.</p></li>
<li><p>Focus on Sentiment-Based Playlists: Curated playlists for specific extreme moods could resonate more with users, allowing them to find songs that match their emotional preference. This will increase user retention and help address user needs on a more specific scale.</p></li>
</ol>
</section>
<section id="for-marketing-teams" class="level4">
<h4 class="anchored" data-anchor-id="for-marketing-teams">For Marketing Teams</h4>
<ol type="1">
<li><p>Prioritize Artist Branding on Social Media: Artist popularity significantly impacts song success. Making sure the artist is well-known and has a strong fanbase will greatly increase the probability that the song will make it to the charts. Additionally, collaboration is often found through social media success and fan interactions, leading to a better chance at increasing popularity.</p></li>
<li><p>Emotionally Driven Advertising: Tying the marketing of songs to the extreme emotions portrayed throught their tones could be helpful. The lyrics should convey an extreme emotion, and showing potential listeners that it does will help draw interest.</p></li>
</ol>
</section>
<section id="potential-for-innovation" class="level4">
<h4 class="anchored" data-anchor-id="potential-for-innovation">Potential For Innovation</h4>
<ol type="1">
<li>These ML techniques show the most likely chances at success. However, attempting to combine multiple pieces might lead to some innovative progress in the music industry. For example, a songwriter blending elements from multiple particularly successful clusters might help create unique songs that can still be considered following genre conventions. This could even appeal to multiple listener bases, which would increase exposure and stream counts.</li>
</ol>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This analysis of the Rolling Stone Top 100 Songs has uncovered valuable insights into the factors driving song success. Key findings show the importance of artist popularity, the influence of emotionally extreme sentiments, and the value in adhering to genre-specific trends. At the same time, clustering algorithms showed that success is not solely determined by these factors and that external factors like social media and marketing might also influence whether a song will be a hit.</p>
<p>We used ML models, sentiment analysis, and clustering techniques to provide actionable strategies for artists, producers, streaming platforms, and marketing teams to support their efforts in creating, promoting, and spreading successful songs. Understanding listener preferences found through data and supporting the creative process with business strategies are truly the key to achieving success in the music industry.</p>
<p>Next Steps:</p>
<ol type="1">
<li><p>Add more features to the dataset such as social media metrics, deeper lyric analysis, and data over multiple time periods to conduct further and more accurate analysis.</p></li>
<li><p>Focus on personalization: Use insights from clustering and popularity metrics to find more nuanced ways to promote listener engagement and support rising artists</p></li>
</ol>
<p>By combining data-driven insights with artistic creativity, the music industry can adapt to changing listener preferences and create songs that truly connect with audiences.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>